#!/bin/bash

# default command tasks
COMMAND="${1:-tasks}"
COMMAND_OPTION_1=$2

# âœ¨ List all tasks âœ¨
function tasks() {
  echo ""
  echo "Howdy! ğŸ‘‹"
  echo "Note: If this is your first time running this script, you might want to run './run *_initialSetup'"
  echo ""
  echo "ğŸªœ  Listing available tasks â³"
  echo ""
  compgen -A function $COMMAND_OPTION_1
}


# âœ¨ Initial setup âœ¨
function nodejs_initialSetup() {
  nodejs_installDeps
  nodejs_build
}

# âœ¨ Node.js install dependencies âœ¨
function nodejs_installDeps() {
  echo "ğŸ“¦  Installing nodejs dependencies... â³"
  cd nodejs-tools/ && npm install && cd ..
  echo "ğŸ“¦  Installing nodejs dependencies completed âœ…"
}

# âœ¨ Node.js clean project âœ¨
CLEAN_NODEJS="npx -y rimraf package-lock.json node_modules dist .turbo build"
function nodejs_clean() {
  echo "ğŸ—‘ï¸  Cleaning nodejs-tools generated files... â³"
  cd nodejs-tools && npm exec --include-workspace-root --workspaces -- $CLEAN_NODEJS && cd ..
  echo "ğŸ—‘ï¸  Cleaning nodejs-tools generated files completed âœ…"
}

# âœ¨ Node.js update packages âœ¨
function nodejs_packageUpdate() {
  echo "ğŸ“¦  Updating nodejs-tools packages... â³"
  cd nodejs-tools && ./node_modules/.bin/ncu -u -ws --root && cd ..
  echo "ğŸ“¦  Updating nodejs-tools packages completed âœ…"
}

# âœ¨ Node.js build âœ¨
function nodejs_build() {
  echo "ğŸ“¦  Building nodejs-tools... â³"
  cd nodejs-tools && npm run build && cd ..
  echo "ğŸ“¦  Building nodejs-tools completed âœ…"
}

# Execute the function name provided to the script as the first argument
$COMMAND
