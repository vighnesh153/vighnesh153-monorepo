#!/bin/bash

# default command tasks
COMMAND="${1:-tasks}"
COMMAND_OPTION_1=$2

# âœ¨ List all tasks âœ¨
function tasks() {
  echo ""
  echo "Howdy! ğŸ‘‹"
  echo "Note: If this is your first time running this script, you might want to run './run initialSetup'"
  echo ""
  echo "ğŸªœ  Listing available tasks â³"
  echo ""
  compgen -A function $COMMAND_OPTION_1
}


# âœ¨ Initial setup âœ¨
function initialSetup() {
  npm install
  cd nodejs-tools/ && npm install && cd ..
}


# âœ¨ Clean Node.js Project âœ¨
CLEAN_NODEJS="npx -y rimraf package-lock.json node_modules dist .turbo"
function cleanNodeJs__root() {
  echo "ğŸ—‘ï¸  Cleaning root nodejs generated files... â³"
  $CLEAN_NODEJS
  echo "ğŸ—‘ï¸  Cleaning root nodejs generated files completed âœ…"
}
function cleanNodeJs__tools() {
  echo "ğŸ—‘ï¸  Cleaning nodejs-tools generated files... â³"
  cd nodejs-tools && npm exec --include-workspace-root --workspaces -- $CLEAN_NODEJS
  echo "ğŸ—‘ï¸  Cleaning nodejs-tools generated files completed âœ…"
}
function cleanNodeJs() {
  echo "ğŸ—‘ï¸  Cleaning all nodejs generated files... â³"
  cleanNodeJs__root
  cleanNodeJs__tools
  echo "ğŸ—‘ï¸  Cleaning all nodejs generated files completed âœ…"
}


# âœ¨ Update NodeJs packages âœ¨
function packageUpdateNodejs__tools() {
  echo "ğŸ“¦  Updating nodejs-tools packages... â³"
  ./node_modules/.bin/ncu -u --cwd=./nodejs-tools/ --ws --root
  echo "ğŸ“¦  Updating nodejs-tools packages completed âœ…"
}
function packageUpdateNodeJs__root() {
  echo "ğŸ“¦  Updating root nodejs packages... â³"
  ./node_modules/.bin/ncu -u
  echo "ğŸ“¦  Updating root nodejs packages completed âœ…"
}
function packageUpdateNodeJs() {
  echo "ğŸ“¦  Updating all nodejs packages... â³"
  packageUpdateNodeJs__root
  packageUpdateNodejs__tools
  echo "ğŸ“¦  Updating all nodejs packages completed âœ…"
}

# Execute the function name provided to the script as the first argument
$COMMAND
